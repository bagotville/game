Overview
----------

Из-за упрощенного формата ревью (все PR под апрув ментора и оценка последнего релизнутого функционала) нет необходимости в доп. ветках.

Основная рабочая ветка — ```master```.
Под тикеты создаются ветки, после  PR они мержатся в ```master```.

Процесс работы над изменением 
-----------------------------
### Работа с тикетом, веткой, коммитом и пушем

* Создаем задачу или переводим на себя существующую:
  - Задачи создаются в [Trello](https://trello.com/c/fuxrRgJb/);
  - На задачу можно назначить только одного исполнителя;
  - Каждой созданной задаче нужно дать короткое и ёмкое название, а также подробное описание задачи и указать контекст ссылкой, если требуется.
* Создаем бранч, имя которого начинается с #id, где id это номера тикета, после которого 1-2 слова, описывающих задачу:
```
# Task #18: Support full text search in GraphService
git checkout -b #18-full_text_search
```

* Commit message пишем по-английски согласно [Git Commit Message Guidelines](https://gist.github.com/robertpainsi/b632364184e70900af4ab688decf6f53):
   - в повелительном наклонении (`Fix` а не `fixed`, `implement` а не `implemented` и т.д.);
   - короче 72 символов:

   ```bash
   git commit -m "#18: Support full text search in GraphService"
   ```
* Если коммит делается после пуша основного фикса, следует использовать префикс `Update`:

   ```bash
   git commit -m "Update #18: Fix review comments"
   ```

* Отправляем изменения на сервер:

   ```bash
   git push
   ```

### Создание Pull Request (PR), процесс ревью и апрува
* Создаем PR руками через Web UI. В процессе создания стоит еще раз посмотреть его в интерфейсе (вкладка Files changed);
* При названии соблюдаем следующий паттерн: #{task id}: {short task description}. Например: ```#11: Add axios and router```
* Если одним PR решено несколько задач, то указываем их в заголовке через запятую, например: ```#11, #22: Add axios and router```
* В описание PR желательно для удобства добавлять ссылку на задачу;
* Мержить можно только после получения двух апрувов: один от участника, один от ментора;
* После создания PR нужно отпрвить ссылку на него в чат команды с указанием всех участников и ментора через @ и кратким описанием изменений своими словами;
* Нельзя мержить PR если есть незарезолвенные комментарии
* Обрати внимание: после обновления ветки новым коммитом с него слетают все апрувы. Поэтому, если требуется реапрув, то желательно повторно позвать команду и ментора в треде сообщений со ссылкой на PR;
* Если все апрувы получены или просто мержить пока рано, поставь перед названием PR ```Draft```;
* Мержит ветку в ```master``` создатель PR или, по возможности, последний кто поставил апрув если не стоит статус ```Draft```;
* Желательно удалять за собой ветки.

**Важно:**

1. Если пришёл новый PR отвлекитесь на 10 минут от собственных задач и
   посмотрите PR, чтобы не задерживать коллег;

2. Если в моменте отвлечься никак нельзя (совещание, деплой, сложная задачка), то стоит выделить полчаса-час времени в начале или конце рабочего дня и просмотреть все PR, что успели свалится за день.

Возможные упрощения процесса для тривиальных изменений
------------------------------------------------------

Примеры тривиальных изменений:

- Исправление опечатки;
- Исправление падающего теста;
- Добавление теста.

Варианты упрощения:

- Не создавать тикет. В этом случае commit message следует начинать с NI: (No Ticket), например:

   ```bash
   git commit -m "NT: Fix failing SomeServiceSpec"
   ```

Удаление старых локальных веток
-------------------------------

Для работы через merge requests с удалением веток очень удобно почистить старые локальные ветки

Есть два варианта:

1) Удалить все ветки которых уже нет в репо и которые уже замержены в текущую:

```shell
git fetch --prune
git branch -r | awk '{print $1}' | egrep -v -f /dev/fd/0 <(git branch -vv | grep origin) | awk '{print $1}' | xargs git branch -d
```
2) Удалить все ветки которые уже влиты в основную master:

```shell
git branch --merged master | grep -v '^[ *]*master$' | xargs git branch -d
```